<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Background and Intuition – l1rotation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8647a4a42273f773479d27c00df3f9ed.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">l1rotation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-articles" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Articles</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-articles">    
        <li>
    <a class="dropdown-item" href="./vignettes/documentation.html">
 <span class="dropdown-text">Getting Started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./intuition.html">
 <span class="dropdown-text">Intuition</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#factor-models-primer" id="toc-factor-models-primer" class="nav-link active" data-scroll-target="#factor-models-primer">Factor Models Primer</a></li>
  <li><a href="#problem-rotational-indeterminacy" id="toc-problem-rotational-indeterminacy" class="nav-link" data-scroll-target="#problem-rotational-indeterminacy">Problem: Rotational Indeterminacy</a></li>
  <li><a href="#solution-use-sparsity" id="toc-solution-use-sparsity" class="nav-link" data-scroll-target="#solution-use-sparsity">Solution: Use Sparsity</a></li>
  <li><a href="#recovering-sparsity" id="toc-recovering-sparsity" class="nav-link" data-scroll-target="#recovering-sparsity">Recovering Sparsity</a>
  <ul class="collapse">
  <li><a href="#objective-function" id="toc-objective-function" class="nav-link" data-scroll-target="#objective-function">Objective Function</a></li>
  </ul></li>
  <li><a href="#a-simple-example" id="toc-a-simple-example" class="nav-link" data-scroll-target="#a-simple-example">A simple example</a>
  <ul class="collapse">
  <li><a href="#interactive-visualization" id="toc-interactive-visualization" class="nav-link" data-scroll-target="#interactive-visualization">Interactive Visualization</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Background and Intuition</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="factor-models-primer" class="level2">
<h2 class="anchored" data-anchor-id="factor-models-primer">Factor Models Primer</h2>
<p>Factor models seek to distill often high dimensional data into a set of underlying or latent factors that capture much of the original variation in the data.</p>
<p>We say the data, <span class="math inline">\(X\)</span>, follows a <strong>factor structure</strong> if:</p>
<p><span class="math display">\[
\begin{align}
\underset{(n \times 1)}{X_{t}} &amp;= \underset{(n \times r)}{\Lambda^{*}_{\vphantom{t}}} \underset{(r \times 1)}{F_t} + \underset{(n \times 1)}{e_{t}} \forall t, \qquad \text{or more compactly,} \qquad \underset{(T \times n)}{X} = \underset{(T \times r)}{F} \underset{(r \times n)}{\Lambda^{*'}}  + \underset{(T \times n)}{e}
\end{align}
\]</span></p>
<p>where there are</p>
<ul>
<li><p><span class="math inline">\(T\)</span> rows (observations),</p></li>
<li><p><span class="math inline">\(n\)</span> columns (variables), and</p></li>
<li><p><span class="math inline">\(r\)</span> factors. And we can refer to</p></li>
<li><p><span class="math inline">\(\lambda_{ik}\)</span> as the entry in <span class="math inline">\(\Lambda^{*'}\)</span> in the <span class="math inline">\(i\)</span>th row and <span class="math inline">\(k\)</span>th column</p></li>
</ul>
<p>This <span class="math inline">\(\lambda_{ik}\)</span> shows how factor <span class="math inline">\(k\)</span> is related to, or “loads onto,” variable <span class="math inline">\(i\)</span>.</p>
<p>Note that <span class="math inline">\(r\)</span> can be learned from the data (cite) so we can assume that <span class="math inline">\(r\)</span> is known. Next, we’re interested in estimating a set of factors <span class="math inline">\(F\)</span>, that compress the data into fewer columns, and loadings <span class="math inline">\(\Lambda^*\)</span>, that show how the factors are related to the original columns. However, there is no unique <span class="math inline">\(F\)</span> and <span class="math inline">\(\Lambda^*\)</span> that satisfies the equation above. In fact, infinitely many will. This is referred to as rotational indeterminacy and it can pose issues in the interpretability of the loadings matrix.</p>
</section>
<section id="problem-rotational-indeterminacy" class="level2">
<h2 class="anchored" data-anchor-id="problem-rotational-indeterminacy">Problem: Rotational Indeterminacy</h2>
<p>To see the problem, let <span class="math inline">\(H\)</span> be any nonsingular <span class="math inline">\(r \times r\)</span> matrix. We can define <span class="math inline">\(\Lambda^0 = \Lambda^* (H^T)^{-1}\)</span> and <span class="math inline">\(F^0 = FH\)</span>. This tells us that</p>
<p><span class="math display">\[
\begin{align}
X &amp; = F^0 \Lambda^{0'} \\
&amp; = FH (H^{-1'})' \Lambda^{*'}\\
&amp; = FH H^{-1} \Lambda^{*'} \\
&amp; = F \Lambda^{*'}
\end{align}
\]</span></p>
<p>Hence <span class="math inline">\(X\)</span> can be explained identically well by any “rotation” <span class="math inline">\(H\)</span> of the loadings and factors, and each rotation provides a different interpretation of how the factors and variables are related. So how can we find the correct rotation, or interpretation?</p>
</section>
<section id="solution-use-sparsity" class="level2">
<h2 class="anchored" data-anchor-id="solution-use-sparsity">Solution: Use Sparsity</h2>
<p>The key idea in Freyaldenhoven (2025) is that assuming a sparsity pattern in the true loadings matrix <span class="math inline">\(\Lambda^*\)</span> solves the issue of rotational indeterminacy since the sparsity pattern is not invariant to rotations. Intuitively, any rotation (or linear combination) of a sparse loading vector will be less sparse. In general, with PCA we can obtain estimates that are a linear combination of the true loadings vectors. That is, we can obtain principal component vectors in the columns of <span class="math inline">\(\Lambda^0\)</span> such that</p>
<p><span class="math display">\[
\begin{align}
\Lambda^0 = \Lambda^*(H^{-1})' + \epsilon
\end{align}
\]</span> where <span class="math inline">\(H\)</span> is as above.</p>
<p>Therefore, since <span class="math inline">\(\Lambda^0\)</span> is a linear combination of <span class="math inline">\(\Lambda^*\)</span>, <span class="math inline">\(\Lambda^*\)</span> is also equal to some linear combination of <span class="math inline">\(\Lambda^0\)</span>. And because linear combinations of sparse loadings are generally dense, there must be a linear combination of <span class="math inline">\(\Lambda^0\)</span> that is sparse. We can then use this sparse linear combination of <span class="math inline">\(\Lambda^0\)</span> as an estimator for <span class="math inline">\(\Lambda^*\)</span>.</p>
<p>Assuming the true loadings are sparse is fairly reasonable, particularly when we’re interested in factors that are thought to affect only a subset of the original columns (i.e., local factors). Such factors are common in economic applications.</p>
</section>
<section id="recovering-sparsity" class="level2">
<h2 class="anchored" data-anchor-id="recovering-sparsity">Recovering Sparsity</h2>
<p>Now, how do we find this sparse linear combination of loading vectors?</p>
<p>The steps are below:</p>
<ol type="1">
<li>Take the principal components estimator as starting point to obtain <span class="math inline">\(\Lambda^0\)</span></li>
<li>Find loadings <span class="math inline">\(\Lambda^*\)</span> equal to the rotation of <span class="math inline">\(\Lambda^0\)</span> that minimizes the number of non-zero elements (the <span class="math inline">\(l_0\)</span> norm) in the loading vectors</li>
</ol>
<p>Unfortunately, the <span class="math inline">\(l_0\)</span> norm is infeasible to optimize over in practice. To see why, let’s examine the figure below. The distance from the origin to each red point depicts the <span class="math inline">\(l_0\)</span> norm of points along the unit circle. The blue points depict the <span class="math inline">\(l_1\)</span> norm and the gray points depict the <span class="math inline">\(l_2\)</span> norm In the <span class="math inline">\(l_2\)</span> case, these distances remain constant as we traverse the circle.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/geom_intuition.png" class="img-fluid figure-img"></p>
<figcaption>Geometric Intuition of Various Norms</figcaption>
</figure>
</div>
<p>The <span class="math inline">\(l_0\)</span> norm directly computes the number of nonzero elements, shown by the red points at (1, 0), (0, 1), (-1, 0) and (0, -1) that are each a distance of 1 away from the origin. The remaining red points are a distance of 2 away from the origin corresponding to the 2 nonzero elements in all other points along the unit circle. Since the blue and red dots coincide at the above four points, the <span class="math inline">\(l_1\)</span> norm is minimized at the same points as the <span class="math inline">\(l_0\)</span> norm. But the <span class="math inline">\(l_1\)</span> norm has a much smoother descent to these minima compared with the discontinuities that occur with the red points. This smooth function is easier to traverse and optimize over.</p>
<p>So throughout, we’ll continue to maximize sparsity indirectly but more easily by swapping the <span class="math inline">\(l_1\)</span> norm for the <span class="math inline">\(l_0\)</span> norm for the optimization benefits.</p>
<section id="objective-function" class="level3">
<h3 class="anchored" data-anchor-id="objective-function">Objective Function</h3>
<p>Formally, using the <span class="math inline">\(l_1\)</span> norm, our objective function becomes</p>
<p><span class="math display">\[
\begin{align}
\min_R ||\Lambda^0R||
\end{align}
\]</span> such that <span class="math inline">\(R\)</span> is nonsingular and <span class="math inline">\(||r_k||_2 = 1\)</span> where <span class="math inline">\(r_k\)</span> is a row in <span class="math inline">\(R\)</span>. This ensures we look only at rotations of each initial loading vector, keeping the length of each loading vector fixed.</p>
<p>Note that the above objective function can be computed and optimized separately for each loading vector individually.</p>
</section>
</section>
<section id="a-simple-example" class="level2">
<h2 class="anchored" data-anchor-id="a-simple-example">A simple example</h2>
<p>Let’s consider an example we can visualize fully: we’ll use the following simulated data that has three columns (<span class="math inline">\(n = 3\)</span>) and suppose we know that there are two factors, <span class="math inline">\(r = 2\)</span>. Below only the first 6 of 224 total rows are printed.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          V1         V2         V3
1  0.6624031 -0.1829747 -0.5026830
2  0.3709347  1.2174531 -1.1426082
3 -1.2000343 -1.2247438 -1.6778625
4  0.5225106  0.9187241 -0.5469126
5  0.4667395 -0.8284538 -0.5829659
6 -0.2022476 -0.1169972  0.1865991</code></pre>
</div>
</div>
<p>Let the true loadings matrix, <span class="math inline">\(\Lambda^*\)</span> be a matrix with 2 columns and 3 rows. As we can see there is a sparsity pattern in the matrix with the first factor affecting only the first column and the second factor affecting the second and third columns of <span class="math inline">\(X\)</span>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  loadings_1 loadings_2
1   1.024946  0.0000000
2   0.000000  1.3517553
3   0.000000  0.2765392</code></pre>
</div>
</div>
<p>Now, let’s look at the PCA estimator for <span class="math inline">\(X\)</span> for the first two principal components. As we can see the zeroes from above are no longer present, but the principal component estimate still provides a great starting point as they are generally linear combinations of the true loading vectors as <span class="math inline">\(n \to \infty\)</span> (cite).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  loadings_1 loadings_2
1 -0.9331464 -1.4110908
2 -1.3219055  0.6307241
3 -0.6179026  0.7816712</code></pre>
</div>
</div>
<p>Let’s try to get a clearer picture of what we have so far by visualizing these components. Below is an interactive visualization of</p>
<ul>
<li>the data points, <span class="math inline">\(X\)</span></li>
<li>the plane spanned by the principal component vectors (blue plane)</li>
<li>the principal component vectors <span class="math inline">\(\Lambda^0\)</span> (orange)</li>
<li>the true loading vectors <span class="math inline">\(\Lambda^*\)</span> (blue)</li>
</ul>
<section id="interactive-visualization" class="level3">
<h3 class="anchored" data-anchor-id="interactive-visualization">Interactive Visualization</h3>
<p>As we can see, the orange principal component vectors span the blue plane. By definition, these two vectors provide the directions of maximal variance of the data. We can also imagine this data cloud projected onto the plane to give us a sense of how the data could be compressed from 3 to 2 dimensions. Notice that the orange vectors are nowhere near the true loading vectors shown in blue. However, simply rotating these orange vectors would give us solutions that are closer to the true (blue) vectors.</p>
<p>Using the sliders below which control the angle of rotation for each vector separately, try rotating the orange vectors along the blue plane to find a rotation that lines up as close as possible to the blue vectors.</p>
<p>Since <span class="math inline">\(n = 3\)</span> is small, we can see there is some noise in the PC estimate, resulting in the loading vectors being located slightly off of this plane. Still, we can get a better estimate of the true vectors by rotating.</p>
<p>As we try different angles of rotation out we can see their impact on the objective function we’re optimizing over. The rotation that best aligns with the true loadings vectors should also occur at the local minima of the objective function.</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="163" data-source-offset="-29"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 162;"><span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>math <span class="op">=</span> <span class="pp">require</span>(<span class="st">'https://cdnjs.cloudflare.com/ajax/libs/mathjs/1.5.2/math.min.js'</span>)</span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@3"</span>)</span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a><span class="co">//functionPlot = require("https://unpkg.com/function-plot@1/dist/function-plot.js")</span></span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a>THREE <span class="op">=</span> {</span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> THREE <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">THREE</span> <span class="op">=</span> <span class="cf">await</span> <span class="pp">require</span>(<span class="st">"three@0.130.0/build/three.min.js"</span>)<span class="op">;</span></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> <span class="pp">require</span>(<span class="st">"three@0.130.0/examples/js/controls/OrbitControls.js"</span>)<span class="op">.</span><span class="fu">catch</span>(() <span class="kw">=&gt;</span> {})<span class="op">;</span></span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> THREE<span class="op">;</span></span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="176" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 175;"><span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a>renderer<span class="op">.</span><span class="at">domElement</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="expression">

</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="184" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 183;"><span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a>viewof theta_value <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a>  [<span class="op">-</span><span class="fl">3.13</span><span class="op">,</span> <span class="fl">3.13</span>]<span class="op">,</span> </span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">value</span><span class="op">:</span> <span class="fl">1.57</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="op">.</span><span class="bn">01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Vector 1 angle (theta):"</span>}</span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a>viewof theta_value2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>(</span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a>  [<span class="op">-</span><span class="fl">3.13</span><span class="op">,</span> <span class="fl">3.13</span>]<span class="op">,</span> </span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">value</span><span class="op">:</span> <span class="fl">3.13</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="op">.</span><span class="bn">01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Vector 2 angle (theta):"</span>}</span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell panel-input card bg-light p-2 quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="ojs-cell-3-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid">
<div class="g-col-24">
<div class="cell panel-fill">
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="201" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 200;"><span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a>highlighted_points <span class="op">=</span> obj_data<span class="op">.</span><span class="fu">filter</span>(<span class="kw">function</span>(penguin) {</span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (theta_value <span class="op">-</span> <span class="fl">0.005</span> <span class="op">&lt;</span> penguin<span class="op">.</span><span class="at">theta</span> <span class="op">&amp;&amp;</span> theta_value <span class="op">+</span> <span class="fl">0.005</span> <span class="op">&gt;</span> penguin<span class="op">.</span><span class="at">theta</span>) <span class="op">||</span></span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a>         (theta_value2 <span class="op">-</span> <span class="fl">0.005</span> <span class="op">&lt;</span> penguin<span class="op">.</span><span class="at">theta</span> <span class="op">&amp;&amp;</span> theta_value2 <span class="op">+</span> <span class="fl">0.005</span> <span class="op">&gt;</span> penguin<span class="op">.</span><span class="at">theta</span>)</span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a>obj_data <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"data/obj_function_data.csv"</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">700</span><span class="op">,</span></span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a>  <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(obj_data<span class="op">,</span> {</span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"theta"</span><span class="op">,</span> </span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a>      <span class="dt">r</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(highlighted_points<span class="op">,</span> {</span>
<span id="cb7-219"><a href="#cb7-219" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"theta"</span><span class="op">,</span> </span>
<span id="cb7-220"><a href="#cb7-220" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> </span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"orange"</span><span class="op">,</span> </span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a>      <span class="dt">r</span><span class="op">:</span> <span class="dv">5</span></span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-224"><a href="#cb7-224" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb7-225"><a href="#cb7-225" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb7-226"><a href="#cb7-226" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">""</span></span>
<span id="cb7-227"><a href="#cb7-227" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb7-228"><a href="#cb7-228" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">"Objective function"</span><span class="op">,</span></span>
<span id="cb7-229"><a href="#cb7-229" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb7-230"><a href="#cb7-230" aria-hidden="true" tabindex="-1"></a>    <span class="dt">background</span><span class="op">:</span> <span class="st">"transparent"</span><span class="op">,</span></span>
<span id="cb7-231"><a href="#cb7-231" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">12</span></span>
<span id="cb7-232"><a href="#cb7-232" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-233"><a href="#cb7-233" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb8" data-startfrom="239" data-source-offset="-1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 238;"><span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> <span class="dv">500</span><span class="op">;</span></span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a>camera <span class="op">=</span> {</span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> fov <span class="op">=</span> <span class="dv">45</span><span class="op">;</span></span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> aspect <span class="op">=</span> width <span class="op">/</span> height<span class="op">;</span></span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> near <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> far <span class="op">=</span> <span class="dv">1000</span><span class="op">;</span></span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> camera <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">PerspectiveCamera</span>(fov<span class="op">,</span> aspect<span class="op">,</span> near<span class="op">,</span> far)<span class="op">;</span></span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a>  camera<span class="op">.</span><span class="at">position</span><span class="op">.</span><span class="fu">set</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span><span class="dv">2</span>)</span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a>  camera<span class="op">.</span><span class="fu">lookAt</span>(<span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> camera<span class="op">;</span></span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a>axesHelper <span class="op">=</span> {<span class="kw">const</span> axesHelper <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">AxesHelper</span>( <span class="dv">5</span> )<span class="op">;</span></span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> axesHelper<span class="op">;</span></span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a>gridHelper <span class="op">=</span> {<span class="kw">const</span> size <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> divisions <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> gridHelper <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">GridHelper</span>( size<span class="op">,</span> divisions )<span class="op">;</span></span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> gridHelper<span class="op">;</span></span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a>renderer <span class="op">=</span> {</span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderer <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">WebGLRenderer</span>({<span class="dt">antialias</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a>  renderer<span class="op">.</span><span class="fu">setSize</span>(width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true" tabindex="-1"></a>  renderer<span class="op">.</span><span class="fu">setPixelRatio</span>(devicePixelRatio)<span class="op">;</span></span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> controls <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">OrbitControls</span>(camera<span class="op">,</span> renderer<span class="op">.</span><span class="at">domElement</span>)<span class="op">;</span></span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true" tabindex="-1"></a>  controls<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"change"</span><span class="op">,</span> () <span class="kw">=&gt;</span> renderer<span class="op">.</span><span class="fu">render</span>(scene<span class="op">,</span> camera))<span class="op">;</span></span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> (controls<span class="op">.</span><span class="fu">dispose</span>()<span class="op">,</span> renderer<span class="op">.</span><span class="fu">dispose</span>()))<span class="op">;</span></span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> renderer<span class="op">;</span></span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="274" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 273;"><span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a>pca_vectors <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">'data/lambda0.csv'</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})</span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a>true_vectors <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">'data/truth_normal.csv'</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})</span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a>display_arrow <span class="op">=</span> {<span class="kw">const</span> dir <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>( pca_vectors[<span class="dv">0</span>]<span class="op">.</span><span class="at">V1</span><span class="op">,</span> pca_vectors[<span class="dv">1</span>]<span class="op">.</span><span class="at">V1</span><span class="op">,</span> pca_vectors[<span class="dv">2</span>]<span class="op">.</span><span class="at">V1</span>)<span class="op">;</span></span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a><span class="co">//normalize the direction vector (convert to vector of length 1)</span></span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a>dir<span class="op">.</span><span class="fu">normalize</span>()<span class="op">;</span></span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> origin <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>( <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span> )<span class="op">;</span></span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> length <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> hex <span class="op">=</span> <span class="bn">0xFFA500</span><span class="op">;</span></span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> arrowHelper <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">ArrowHelper</span>( dir<span class="op">,</span> origin<span class="op">,</span> length<span class="op">,</span> hex )<span class="op">;</span></span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> arrowHelper<span class="op">;</span></span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a>display_arrow2 <span class="op">=</span> {<span class="kw">const</span> dir <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>( pca_vectors[<span class="dv">0</span>]<span class="op">.</span><span class="at">V2</span><span class="op">,</span> pca_vectors[<span class="dv">1</span>]<span class="op">.</span><span class="at">V2</span><span class="op">,</span> pca_vectors[<span class="dv">2</span>]<span class="op">.</span><span class="at">V2</span>)<span class="op">;</span></span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a><span class="co">//normalize the direction vector (convert to vector of length 1)</span></span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a>dir<span class="op">.</span><span class="fu">normalize</span>()<span class="op">;</span></span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> origin <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>( <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span> )<span class="op">;</span></span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> length <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> hex <span class="op">=</span> <span class="bn">0xFFA500</span><span class="op">;</span></span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> arrowHelper <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">ArrowHelper</span>( dir<span class="op">,</span> origin<span class="op">,</span> length<span class="op">,</span> hex )<span class="op">;</span></span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> arrowHelper<span class="op">;</span></span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a>true_vector1 <span class="op">=</span> {<span class="kw">const</span> dir <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>( true_vectors[<span class="dv">0</span>]<span class="op">.</span><span class="at">V1</span><span class="op">,</span> true_vectors[<span class="dv">1</span>]<span class="op">.</span><span class="at">V1</span><span class="op">,</span> true_vectors[<span class="dv">2</span>]<span class="op">.</span><span class="at">V1</span>)<span class="op">;</span></span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a><span class="co">//normalize the direction vector (convert to vector of length 1)</span></span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a>dir<span class="op">.</span><span class="fu">normalize</span>()<span class="op">;</span></span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> origin <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>( <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span> )<span class="op">;</span></span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> length <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> hex <span class="op">=</span> <span class="bn">0x0000FF</span><span class="op">;</span></span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> arrowHelper <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">ArrowHelper</span>( dir<span class="op">,</span> origin<span class="op">,</span> length<span class="op">,</span> hex )<span class="op">;</span></span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> arrowHelper<span class="op">;</span></span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a>true_vector2 <span class="op">=</span> {<span class="kw">const</span> dir <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>( true_vectors[<span class="dv">0</span>]<span class="op">.</span><span class="at">V2</span><span class="op">,</span> true_vectors[<span class="dv">1</span>]<span class="op">.</span><span class="at">V2</span><span class="op">,</span> true_vectors[<span class="dv">2</span>]<span class="op">.</span><span class="at">V2</span>)<span class="op">;</span></span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a><span class="co">//normalize the direction vector (convert to vector of length 1)</span></span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>dir<span class="op">.</span><span class="fu">normalize</span>()<span class="op">;</span></span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> origin <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>( <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span> )<span class="op">;</span></span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> length <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> hex <span class="op">=</span> <span class="bn">0x0000FF</span><span class="op">;</span></span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> arrowHelper <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">ArrowHelper</span>( dir<span class="op">,</span> origin<span class="op">,</span> length<span class="op">,</span> hex )<span class="op">;</span></span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> arrowHelper<span class="op">;</span></span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a>math_plane <span class="op">=</span> {</span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> v1 <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>( pca_vectors[<span class="dv">0</span>]<span class="op">.</span><span class="at">V1</span><span class="op">,</span> pca_vectors[<span class="dv">1</span>]<span class="op">.</span><span class="at">V1</span><span class="op">,</span> pca_vectors[<span class="dv">2</span>]<span class="op">.</span><span class="at">V1</span> )</span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> v2 <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>( pca_vectors[<span class="dv">0</span>]<span class="op">.</span><span class="at">V2</span><span class="op">,</span> pca_vectors[<span class="dv">1</span>]<span class="op">.</span><span class="at">V2</span><span class="op">,</span> pca_vectors[<span class="dv">2</span>]<span class="op">.</span><span class="at">V2</span> )</span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> normal <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>()<span class="op">.</span><span class="fu">crossVectors</span>(v1<span class="op">,</span> v2)<span class="op">.</span><span class="fu">normalize</span>()<span class="op">;</span></span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plane <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Plane</span>(normal)<span class="op">;</span></span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> helper <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">PlaneHelper</span>( plane<span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="bn">0x0000FF</span> )<span class="op">;</span></span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> helper<span class="op">;</span></span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>}       </span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> {</span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">'data/data.csv'</span>)<span class="op">.</span><span class="fu">csv</span>({<span class="dt">typed</span><span class="op">:</span> <span class="kw">true</span>})<span class="op">;</span></span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> geometry <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">BufferGeometry</span>()<span class="op">;</span></span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> positions <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>(data<span class="op">.</span><span class="fu">flatMap</span>(d <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">V1</span><span class="op">,</span> d<span class="op">.</span><span class="at">V2</span><span class="op">,</span> d<span class="op">.</span><span class="at">V3</span>]))<span class="op">;</span></span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a>  geometry<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"position"</span><span class="op">,</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">BufferAttribute</span>(positions<span class="op">,</span> <span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> material <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">PointsMaterial</span>({<span class="dt">color</span><span class="op">:</span> <span class="bn">0x000000</span><span class="op">,</span> <span class="dt">size</span><span class="op">:</span> <span class="fl">0.1</span>})<span class="op">;</span></span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> points <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Points</span>(geometry<span class="op">,</span> material)<span class="op">;</span></span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> points</span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-8" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="361" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 360;"><span id="cb10-361"><a href="#cb10-361" aria-hidden="true" tabindex="-1"></a>scene <span class="op">=</span> {</span>
<span id="cb10-362"><a href="#cb10-362" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scene <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Scene</span>()<span class="op">;</span></span>
<span id="cb10-363"><a href="#cb10-363" aria-hidden="true" tabindex="-1"></a>  scene<span class="op">.</span><span class="at">background</span> <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Color</span>(<span class="bn">0xffffff</span>)<span class="op">;</span></span>
<span id="cb10-364"><a href="#cb10-364" aria-hidden="true" tabindex="-1"></a>  scene<span class="op">.</span><span class="fu">add</span>(gridHelper)<span class="op">;</span></span>
<span id="cb10-365"><a href="#cb10-365" aria-hidden="true" tabindex="-1"></a>  scene<span class="op">.</span><span class="fu">add</span>(axesHelper)<span class="op">;</span></span>
<span id="cb10-366"><a href="#cb10-366" aria-hidden="true" tabindex="-1"></a>  scene<span class="op">.</span><span class="fu">add</span>(display_arrow)<span class="op">;</span></span>
<span id="cb10-367"><a href="#cb10-367" aria-hidden="true" tabindex="-1"></a>  scene<span class="op">.</span><span class="fu">add</span>(display_arrow2)<span class="op">;</span></span>
<span id="cb10-368"><a href="#cb10-368" aria-hidden="true" tabindex="-1"></a>  scene<span class="op">.</span><span class="fu">add</span>(true_vector1)<span class="op">;</span></span>
<span id="cb10-369"><a href="#cb10-369" aria-hidden="true" tabindex="-1"></a>  scene<span class="op">.</span><span class="fu">add</span>(true_vector2)<span class="op">;</span></span>
<span id="cb10-370"><a href="#cb10-370" aria-hidden="true" tabindex="-1"></a>  scene<span class="op">.</span><span class="fu">add</span>(math_plane)<span class="op">;</span></span>
<span id="cb10-371"><a href="#cb10-371" aria-hidden="true" tabindex="-1"></a>  scene<span class="op">.</span><span class="fu">add</span>(points)<span class="op">;</span></span>
<span id="cb10-372"><a href="#cb10-372" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> scene<span class="op">;</span></span>
<span id="cb10-373"><a href="#cb10-373" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-374"><a href="#cb10-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-375"><a href="#cb10-375" aria-hidden="true" tabindex="-1"></a>{<span class="kw">const</span> normal <span class="op">=</span> math_plane<span class="op">.</span><span class="at">plane</span><span class="op">.</span><span class="at">normal</span><span class="op">;</span></span>
<span id="cb10-376"><a href="#cb10-376" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> rotation_matrix <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Matrix4</span>()<span class="op">.</span><span class="fu">makeRotationAxis</span>(normal<span class="op">,</span> theta_value)<span class="op">;</span></span>
<span id="cb10-377"><a href="#cb10-377" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> new_direction <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>(pca_vectors[<span class="dv">0</span>]<span class="op">.</span><span class="at">V1</span><span class="op">,</span> pca_vectors[<span class="dv">1</span>]<span class="op">.</span><span class="at">V1</span><span class="op">,</span> pca_vectors[<span class="dv">2</span>]<span class="op">.</span><span class="at">V1</span>)<span class="op">.</span><span class="fu">normalize</span>()<span class="op">.</span><span class="fu">applyMatrix4</span>(rotation_matrix)<span class="op">;</span></span>
<span id="cb10-378"><a href="#cb10-378" aria-hidden="true" tabindex="-1"></a>display_arrow<span class="op">.</span><span class="fu">setDirection</span>(new_direction)<span class="op">;</span>             </span>
<span id="cb10-379"><a href="#cb10-379" aria-hidden="true" tabindex="-1"></a>renderer<span class="op">.</span><span class="fu">render</span>(scene<span class="op">,</span> camera)<span class="op">;</span></span>
<span id="cb10-380"><a href="#cb10-380" aria-hidden="true" tabindex="-1"></a><span class="kw">yield</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb10-381"><a href="#cb10-381" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-2" data-nodetype="expression">

</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="383" data-source-offset="-686"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 382;"><span id="cb11-383"><a href="#cb11-383" aria-hidden="true" tabindex="-1"></a>{<span class="kw">const</span> normal <span class="op">=</span> math_plane<span class="op">.</span><span class="at">plane</span><span class="op">.</span><span class="at">normal</span><span class="op">;</span></span>
<span id="cb11-384"><a href="#cb11-384" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> rotation_matrix <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Matrix4</span>()<span class="op">.</span><span class="fu">makeRotationAxis</span>(normal<span class="op">,</span> theta_value2)<span class="op">;</span></span>
<span id="cb11-385"><a href="#cb11-385" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> new_direction <span class="op">=</span> <span class="kw">new</span> THREE<span class="op">.</span><span class="fu">Vector3</span>(pca_vectors[<span class="dv">0</span>]<span class="op">.</span><span class="at">V2</span><span class="op">,</span> pca_vectors[<span class="dv">1</span>]<span class="op">.</span><span class="at">V2</span><span class="op">,</span> pca_vectors[<span class="dv">2</span>]<span class="op">.</span><span class="at">V2</span>)<span class="op">.</span><span class="fu">normalize</span>()<span class="op">.</span><span class="fu">applyMatrix4</span>(rotation_matrix)<span class="op">;</span></span>
<span id="cb11-386"><a href="#cb11-386" aria-hidden="true" tabindex="-1"></a>display_arrow2<span class="op">.</span><span class="fu">setDirection</span>(new_direction)<span class="op">;</span>             </span>
<span id="cb11-387"><a href="#cb11-387" aria-hidden="true" tabindex="-1"></a>renderer<span class="op">.</span><span class="fu">render</span>(scene<span class="op">,</span> camera)<span class="op">;</span></span>
<span id="cb11-388"><a href="#cb11-388" aria-hidden="true" tabindex="-1"></a><span class="kw">yield</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb11-389"><a href="#cb11-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-390"><a href="#cb11-390" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>The above visualizations show the relationship between the angles of rotation, the objective function optimizing for sparsity, and the position of the vectors in space relative to the true loadings. This is the crux of the intuition and reasoning behind this research and accompanying package.</p>


</section>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIExvYWQgT2JzZXJ2YWJsZSBsaWJyYXJpZXNcbm1hdGggPSByZXF1aXJlKCdodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9tYXRoanMvMS41LjIvbWF0aC5taW4uanMnKVxuZDMgPSByZXF1aXJlKFwiZDNAM1wiKVxuLy9mdW5jdGlvblBsb3QgPSByZXF1aXJlKFwiaHR0cHM6Ly91bnBrZy5jb20vZnVuY3Rpb24tcGxvdEAxL2Rpc3QvZnVuY3Rpb24tcGxvdC5qc1wiKVxuXG5USFJFRSA9IHtcbiAgY29uc3QgVEhSRUUgPSB3aW5kb3cuVEhSRUUgPSBhd2FpdCByZXF1aXJlKFwidGhyZWVAMC4xMzAuMC9idWlsZC90aHJlZS5taW4uanNcIik7XG4gIGF3YWl0IHJlcXVpcmUoXCJ0aHJlZUAwLjEzMC4wL2V4YW1wbGVzL2pzL2NvbnRyb2xzL09yYml0Q29udHJvbHMuanNcIikuY2F0Y2goKCkgPT4ge30pO1xuICByZXR1cm4gVEhSRUU7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZW5kZXJlci5kb21FbGVtZW50XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgdGhldGFfdmFsdWUgPSBJbnB1dHMucmFuZ2UoXG4gIFstMy4xMywgMy4xM10sIFxuICB7dmFsdWU6IDEuNTcsIHN0ZXA6IC4wMSwgbGFiZWw6IFwiVmVjdG9yIDEgYW5nbGUgKHRoZXRhKTpcIn1cbilcblxudmlld29mIHRoZXRhX3ZhbHVlMiA9IElucHV0cy5yYW5nZShcbiAgWy0zLjEzLCAzLjEzXSwgXG4gIHt2YWx1ZTogMy4xMywgc3RlcDogLjAxLCBsYWJlbDogXCJWZWN0b3IgMiBhbmdsZSAodGhldGEpOlwifVxuKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5oaWdobGlnaHRlZF9wb2ludHMgPSBvYmpfZGF0YS5maWx0ZXIoZnVuY3Rpb24ocGVuZ3Vpbikge1xuICByZXR1cm4gKHRoZXRhX3ZhbHVlIC0gMC4wMDUgPCBwZW5ndWluLnRoZXRhICYmIHRoZXRhX3ZhbHVlICsgMC4wMDUgPiBwZW5ndWluLnRoZXRhKSB8fFxuICAgICAgICAgKHRoZXRhX3ZhbHVlMiAtIDAuMDA1IDwgcGVuZ3Vpbi50aGV0YSAmJiB0aGV0YV92YWx1ZTIgKyAwLjAwNSA+IHBlbmd1aW4udGhldGEpXG59KVxuXG5vYmpfZGF0YSA9IEZpbGVBdHRhY2htZW50KFwiZGF0YS9vYmpfZnVuY3Rpb25fZGF0YS5jc3ZcIikuY3N2KHt0eXBlZDogdHJ1ZX0pO1xuXG5QbG90LnBsb3Qoe1xuICBoZWlnaHQ6IDEwMCxcbiAgd2lkdGg6IDcwMCxcbiAgZ3JpZDogdHJ1ZSxcbiAgbWFya3M6IFtcbiAgICBQbG90LmRvdChvYmpfZGF0YSwge1xuICAgICAgeDogXCJ0aGV0YVwiLCBcbiAgICAgIHk6IFwieVwiLFxuICAgICAgcjogMVxuICAgIH0pLFxuICAgIFBsb3QuZG90KGhpZ2hsaWdodGVkX3BvaW50cywge1xuICAgICAgeDogXCJ0aGV0YVwiLCBcbiAgICAgIHk6IFwieVwiLCBcbiAgICAgIGZpbGw6IFwib3JhbmdlXCIsIFxuICAgICAgcjogNVxuICAgIH0pXG4gIF0sXG4gIHk6IHtcbiAgICBsYWJlbDogXCJcIlxuICB9LFxuICB0aXRsZTogXCJPYmplY3RpdmUgZnVuY3Rpb25cIixcbiAgc3R5bGU6IHtcbiAgICBiYWNrZ3JvdW5kOiBcInRyYW5zcGFyZW50XCIsXG4gICAgZm9udFNpemU6IDEyXG4gIH1cbn0pXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuaGVpZ2h0ID0gNTAwO1xuY2FtZXJhID0ge1xuICBjb25zdCBmb3YgPSA0NTtcbiAgY29uc3QgYXNwZWN0ID0gd2lkdGggLyBoZWlnaHQ7XG4gIGNvbnN0IG5lYXIgPSAxO1xuICBjb25zdCBmYXIgPSAxMDAwO1xuICBjb25zdCBjYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoZm92LCBhc3BlY3QsIG5lYXIsIGZhcik7XG4gIGNhbWVyYS5wb3NpdGlvbi5zZXQoMiwgMiwgLTIpXG4gIGNhbWVyYS5sb29rQXQobmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMCkpO1xuICByZXR1cm4gY2FtZXJhO1xufVxuYXhlc0hlbHBlciA9IHtjb25zdCBheGVzSGVscGVyID0gbmV3IFRIUkVFLkF4ZXNIZWxwZXIoIDUgKTtcbnJldHVybiBheGVzSGVscGVyO1xufVxuXG5ncmlkSGVscGVyID0ge2NvbnN0IHNpemUgPSAxMDtcbmNvbnN0IGRpdmlzaW9ucyA9IDEwO1xuXG5jb25zdCBncmlkSGVscGVyID0gbmV3IFRIUkVFLkdyaWRIZWxwZXIoIHNpemUsIGRpdmlzaW9ucyApO1xucmV0dXJuIGdyaWRIZWxwZXI7XG59XG5cbnJlbmRlcmVyID0ge1xuICBjb25zdCByZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHthbnRpYWxpYXM6IHRydWV9KTtcbiAgcmVuZGVyZXIuc2V0U2l6ZSh3aWR0aCwgaGVpZ2h0KTtcbiAgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyhkZXZpY2VQaXhlbFJhdGlvKTtcbiAgY29uc3QgY29udHJvbHMgPSBuZXcgVEhSRUUuT3JiaXRDb250cm9scyhjYW1lcmEsIHJlbmRlcmVyLmRvbUVsZW1lbnQpO1xuICBjb250cm9scy5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsICgpID0+IHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgY2FtZXJhKSk7XG4gIGludmFsaWRhdGlvbi50aGVuKCgpID0+IChjb250cm9scy5kaXNwb3NlKCksIHJlbmRlcmVyLmRpc3Bvc2UoKSkpO1xuICByZXR1cm4gcmVuZGVyZXI7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwY2FfdmVjdG9ycyA9IGF3YWl0IEZpbGVBdHRhY2htZW50KCdkYXRhL2xhbWJkYTAuY3N2JykuY3N2KHt0eXBlZDogdHJ1ZX0pXG50cnVlX3ZlY3RvcnMgPSBhd2FpdCBGaWxlQXR0YWNobWVudCgnZGF0YS90cnV0aF9ub3JtYWwuY3N2JykuY3N2KHt0eXBlZDogdHJ1ZX0pXG5cblxuZGlzcGxheV9hcnJvdyA9IHtjb25zdCBkaXIgPSBuZXcgVEhSRUUuVmVjdG9yMyggcGNhX3ZlY3RvcnNbMF0uVjEsIHBjYV92ZWN0b3JzWzFdLlYxLCBwY2FfdmVjdG9yc1syXS5WMSk7XG5cbi8vbm9ybWFsaXplIHRoZSBkaXJlY3Rpb24gdmVjdG9yIChjb252ZXJ0IHRvIHZlY3RvciBvZiBsZW5ndGggMSlcbmRpci5ub3JtYWxpemUoKTtcblxuY29uc3Qgb3JpZ2luID0gbmV3IFRIUkVFLlZlY3RvcjMoIDAsIDAsIDAgKTtcbmNvbnN0IGxlbmd0aCA9IDE7XG5jb25zdCBoZXggPSAweEZGQTUwMDtcblxuY29uc3QgYXJyb3dIZWxwZXIgPSBuZXcgVEhSRUUuQXJyb3dIZWxwZXIoIGRpciwgb3JpZ2luLCBsZW5ndGgsIGhleCApO1xucmV0dXJuIGFycm93SGVscGVyO1xuICAgICAgICB9XG4gICAgICAgIFxuZGlzcGxheV9hcnJvdzIgPSB7Y29uc3QgZGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoIHBjYV92ZWN0b3JzWzBdLlYyLCBwY2FfdmVjdG9yc1sxXS5WMiwgcGNhX3ZlY3RvcnNbMl0uVjIpO1xuXG4vL25vcm1hbGl6ZSB0aGUgZGlyZWN0aW9uIHZlY3RvciAoY29udmVydCB0byB2ZWN0b3Igb2YgbGVuZ3RoIDEpXG5kaXIubm9ybWFsaXplKCk7XG5cbmNvbnN0IG9yaWdpbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCAwLCAwLCAwICk7XG5jb25zdCBsZW5ndGggPSAxO1xuY29uc3QgaGV4ID0gMHhGRkE1MDA7XG5cbmNvbnN0IGFycm93SGVscGVyID0gbmV3IFRIUkVFLkFycm93SGVscGVyKCBkaXIsIG9yaWdpbiwgbGVuZ3RoLCBoZXggKTtcbnJldHVybiBhcnJvd0hlbHBlcjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgXG50cnVlX3ZlY3RvcjEgPSB7Y29uc3QgZGlyID0gbmV3IFRIUkVFLlZlY3RvcjMoIHRydWVfdmVjdG9yc1swXS5WMSwgdHJ1ZV92ZWN0b3JzWzFdLlYxLCB0cnVlX3ZlY3RvcnNbMl0uVjEpO1xuXG4vL25vcm1hbGl6ZSB0aGUgZGlyZWN0aW9uIHZlY3RvciAoY29udmVydCB0byB2ZWN0b3Igb2YgbGVuZ3RoIDEpXG5kaXIubm9ybWFsaXplKCk7XG5cbmNvbnN0IG9yaWdpbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCAwLCAwLCAwICk7XG5jb25zdCBsZW5ndGggPSAxO1xuY29uc3QgaGV4ID0gMHgwMDAwRkY7XG5cbmNvbnN0IGFycm93SGVscGVyID0gbmV3IFRIUkVFLkFycm93SGVscGVyKCBkaXIsIG9yaWdpbiwgbGVuZ3RoLCBoZXggKTtcbnJldHVybiBhcnJvd0hlbHBlcjtcbiAgICAgICAgfVxuICAgICAgICBcbnRydWVfdmVjdG9yMiA9IHtjb25zdCBkaXIgPSBuZXcgVEhSRUUuVmVjdG9yMyggdHJ1ZV92ZWN0b3JzWzBdLlYyLCB0cnVlX3ZlY3RvcnNbMV0uVjIsIHRydWVfdmVjdG9yc1syXS5WMik7XG5cbi8vbm9ybWFsaXplIHRoZSBkaXJlY3Rpb24gdmVjdG9yIChjb252ZXJ0IHRvIHZlY3RvciBvZiBsZW5ndGggMSlcbmRpci5ub3JtYWxpemUoKTtcblxuY29uc3Qgb3JpZ2luID0gbmV3IFRIUkVFLlZlY3RvcjMoIDAsIDAsIDAgKTtcbmNvbnN0IGxlbmd0aCA9IDE7XG5jb25zdCBoZXggPSAweDAwMDBGRjtcblxuY29uc3QgYXJyb3dIZWxwZXIgPSBuZXcgVEhSRUUuQXJyb3dIZWxwZXIoIGRpciwgb3JpZ2luLCBsZW5ndGgsIGhleCApO1xucmV0dXJuIGFycm93SGVscGVyO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBcbiAgICAgICAgXG5tYXRoX3BsYW5lID0ge1xuICBjb25zdCB2MSA9IG5ldyBUSFJFRS5WZWN0b3IzKCBwY2FfdmVjdG9yc1swXS5WMSwgcGNhX3ZlY3RvcnNbMV0uVjEsIHBjYV92ZWN0b3JzWzJdLlYxIClcbiAgY29uc3QgdjIgPSBuZXcgVEhSRUUuVmVjdG9yMyggcGNhX3ZlY3RvcnNbMF0uVjIsIHBjYV92ZWN0b3JzWzFdLlYyLCBwY2FfdmVjdG9yc1syXS5WMiApXG4gIGNvbnN0IG5vcm1hbCA9IG5ldyBUSFJFRS5WZWN0b3IzKCkuY3Jvc3NWZWN0b3JzKHYxLCB2Mikubm9ybWFsaXplKCk7XG4gIGNvbnN0IHBsYW5lID0gbmV3IFRIUkVFLlBsYW5lKG5vcm1hbCk7XG4gIGNvbnN0IGhlbHBlciA9IG5ldyBUSFJFRS5QbGFuZUhlbHBlciggcGxhbmUsIDIsIDB4MDAwMEZGICk7XG4gIHJldHVybiBoZWxwZXI7XG4gIFxufSAgICAgICBcblxuXG5cbnBvaW50cyA9IHtcbiAgY29uc3QgZGF0YSA9IGF3YWl0IEZpbGVBdHRhY2htZW50KCdkYXRhL2RhdGEuY3N2JykuY3N2KHt0eXBlZDogdHJ1ZX0pO1xuICBjb25zdCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5CdWZmZXJHZW9tZXRyeSgpO1xuICBjb25zdCBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KGRhdGEuZmxhdE1hcChkID0+IFtkLlYxLCBkLlYyLCBkLlYzXSkpO1xuICBnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoXCJwb3NpdGlvblwiLCBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKHBvc2l0aW9ucywgMykpO1xuXG4gIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLlBvaW50c01hdGVyaWFsKHtjb2xvcjogMHgwMDAwMDAsIHNpemU6IDAuMX0pO1xuICBjb25zdCBwb2ludHMgPSBuZXcgVEhSRUUuUG9pbnRzKGdlb21ldHJ5LCBtYXRlcmlhbCk7XG4gIHJldHVybiBwb2ludHNcbn1cblxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoic2NlbmUgPSB7XG4gIGNvbnN0IHNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG4gIHNjZW5lLmJhY2tncm91bmQgPSBuZXcgVEhSRUUuQ29sb3IoMHhmZmZmZmYpO1xuICBzY2VuZS5hZGQoZ3JpZEhlbHBlcik7XG4gIHNjZW5lLmFkZChheGVzSGVscGVyKTtcbiAgc2NlbmUuYWRkKGRpc3BsYXlfYXJyb3cpO1xuICBzY2VuZS5hZGQoZGlzcGxheV9hcnJvdzIpO1xuICBzY2VuZS5hZGQodHJ1ZV92ZWN0b3IxKTtcbiAgc2NlbmUuYWRkKHRydWVfdmVjdG9yMik7XG4gIHNjZW5lLmFkZChtYXRoX3BsYW5lKTtcbiAgc2NlbmUuYWRkKHBvaW50cyk7XG4gIHJldHVybiBzY2VuZTtcbn1cblxue2NvbnN0IG5vcm1hbCA9IG1hdGhfcGxhbmUucGxhbmUubm9ybWFsO1xuY29uc3Qgcm90YXRpb25fbWF0cml4ID0gbmV3IFRIUkVFLk1hdHJpeDQoKS5tYWtlUm90YXRpb25BeGlzKG5vcm1hbCwgdGhldGFfdmFsdWUpO1xuY29uc3QgbmV3X2RpcmVjdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKHBjYV92ZWN0b3JzWzBdLlYxLCBwY2FfdmVjdG9yc1sxXS5WMSwgcGNhX3ZlY3RvcnNbMl0uVjEpLm5vcm1hbGl6ZSgpLmFwcGx5TWF0cml4NChyb3RhdGlvbl9tYXRyaXgpO1xuZGlzcGxheV9hcnJvdy5zZXREaXJlY3Rpb24obmV3X2RpcmVjdGlvbik7ICAgICAgICAgICAgIFxucmVuZGVyZXIucmVuZGVyKHNjZW5lLCBjYW1lcmEpO1xueWllbGQgbnVsbDtcbn1cblxue2NvbnN0IG5vcm1hbCA9IG1hdGhfcGxhbmUucGxhbmUubm9ybWFsO1xuY29uc3Qgcm90YXRpb25fbWF0cml4ID0gbmV3IFRIUkVFLk1hdHJpeDQoKS5tYWtlUm90YXRpb25BeGlzKG5vcm1hbCwgdGhldGFfdmFsdWUyKTtcbmNvbnN0IG5ld19kaXJlY3Rpb24gPSBuZXcgVEhSRUUuVmVjdG9yMyhwY2FfdmVjdG9yc1swXS5WMiwgcGNhX3ZlY3RvcnNbMV0uVjIsIHBjYV92ZWN0b3JzWzJdLlYyKS5ub3JtYWxpemUoKS5hcHBseU1hdHJpeDQocm90YXRpb25fbWF0cml4KTtcbmRpc3BsYXlfYXJyb3cyLnNldERpcmVjdGlvbihuZXdfZGlyZWN0aW9uKTsgICAgICAgICAgICAgXG5yZW5kZXJlci5yZW5kZXIoc2NlbmUsIGNhbWVyYSk7XG55aWVsZCBudWxsO1xuXG59XG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgndGhldGFfdmFsdWUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgndGhldGFfdmFsdWUyJykifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/kobleary\.github\.io\/quarto-example\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>